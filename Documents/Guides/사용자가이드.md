# 📖 더문드립바 웹 시스템 사용 가이드

**최종 버전:** 2.0.0
**작성일:** 2025-10-24
**상태:** 정식 운영 준비

---

## 🚀 빠른 시작

### 1단계: 애플리케이션 실행

```bash
# 프로젝트 디렉토리로 이동
cd /mnt/d/Ai/WslProject/TheMoon_Project

# 애플리케이션 시작
./venv/bin/streamlit run app/app.py
```

### 2단계: 브라우저 접속

```
http://localhost:8501
```

### 3단계: 로그인 (현재는 로그인 불필요)

메인 페이지(대시보드)가 자동 로드됩니다.

---

## 📋 페이지별 가이드

### 🏠 1. 대시보드

**위치:** 좌측 메뉴 → 1️⃣ 대시보드

#### 기능
- 📊 핵심 지표 (원두, 블렌드, 포션, 가격)
- 🔥 로스팅 레벨 분포
- 🎨 블렌드 타입 분포
- 💰 원가 분석
- ⚠️ 저재고/과재고 경고

#### 사용 팁
- 우측 상단 "🔄" 버튼으로 실시간 새로고침
- 각 차트 위에 마우스를 올려 상세 정보 확인
- 빠른 메뉴로 다른 페이지 이동

---

### ☕ 2. 원두 관리

**위치:** 좌측 메뉴 → 2️⃣ 원두관리

#### 📋 목록 탭

**기능:**
- 모든 원두 조회
- 필터링 (국가, 로스팅 레벨)
- 검색 (원두명)
- 통계 보기

**사용 방법:**
```
1. "국가 필터" 선택: 특정 국가의 원두만 보기
2. "로스팅 필터" 선택: 특정 로스팅의 원두만 보기
3. "원두명 검색": 키워드로 검색
4. 통계에서 평균 가격 등 확인
```

#### ➕ 추가 탭

**새 원두 추가 방법:**
```
1. 원두 번호 입력
2. 원두명 입력 (필수)
3. 국가코드 선택
4. 로스팅 레벨 선택
5. 가격(원/kg) 입력
6. "✅ 원두 추가" 클릭
```

#### ✏️ 편집 탭

**원두 수정 방법:**
```
1. "편집할 원두 선택" 드롭다운
2. 원하는 정보 수정
3. "✅ 저장" 클릭
```

**원두 삭제:**
```
1. 편집 폼 아래 "🗑️ 이 원두 삭제" 클릭
→ 비활성화됨 (영구 삭제 아님)
```

#### 📊 통계 탭

- 로스팅 분포 파이 차트
- 가장 비싼/싼 원두 TOP 3
- CSV 다운로드 (엑셀에서 열기 가능)

---

### 🎨 3. 블렌딩 관리

**위치:** 좌측 메뉴 → 3️⃣ 블렌딩관리

#### 📋 목록 탭

**기능:**
- 모든 블렌드 조회
- 타입별 필터 (풀문, 뉴문, 시즈널)
- 포션당 원가 자동 계산
- 제안 판매가 표시

#### 🎨 상세보기 탭

**상세 정보:**
- 블렌드 이름, 타입, 포션 개수
- 레시피 원두 목록
- **포션 구성 파이 차트** (시각화)
- **원가 계산 상세:**
  - 세부 원가 (원두, 로스팅, 인건비, 기타)
  - 포션당 원가
  - 제안 판매가
  - 예상 이익

#### ➕ 추가 탭

**새 블렌드 생성:**
```
1. 블렌드명 입력 (예: "스프링 블렌드")
2. 타입 선택 (풀문/뉴문/시즈널)
3. 포함할 원두 개수 선택
4. 각 원두와 포션 입력
5. "✅ 블렌드 추가" 클릭
```

**예시:**
```
블렌드명: 스프링 블렌드
타입: 풀문
포함 원두 개수: 3
─────────
원두 1: 예가체프 (포션 2)
원두 2: 콜롬비아 (포션 2)
원두 3: 브라질 (포션 1)
```

#### ✏️ 편집 탭

**블렌드 수정:**
```
1. "편집할 블렌드 선택"
2. 이름, 타입, 가격 수정
3. "✅ 저장" 클릭
```

**레시피 수정:** 현재는 완전 수정 미지원 (향후 개선 예정)

---

### 📊 4. 분석

**위치:** 좌측 메뉴 → 4️⃣ 분석

#### 📈 개요 탭
- 핵심 지표
- 로스팅 분포
- 블렌드 타입 분포

#### ☕ 원두 분석 탭
- 원두별 가격 막대 차트
- 로스팅별 분포
- 국가별 분포

#### 🎨 블렌드 분석 탭
- 포션당 원가 비교
- 제안 판매가 비교
- 예상 이익 분석

#### 💰 비용 분석 탭
- 날짜 범위 선택 가능
- 블렌드별 비용 상세
- 비용 구성 파이 차트
- 누적 비용 비교 차트

#### 📊 통계 탭
- 종합 통계
- 로스팅 상세 통계
- 블렌드 타입 통계
- 최고/최저 분석

---

### 📦 5. 재고 관리

**위치:** 좌측 메뉴 → 5️⃣ 재고관리

#### 📊 현황 탭

**재고 상태 확인:**
- 원두별 현재 재고
- 최소/최대 재고 범위
- 상태 아이콘:
  - 🟢 정상 (최소 이상, 최대 이하)
  - 🔴 저재고 (최소 미만)
  - 🟡 과재고 (최대 초과)

**재고 현황 차트:**
- 원두별 현재 보유량 시각화

#### 📝 거래 기록 탭

**최근 30일 거래 조회:**
- 거래 유형 (입고/사용)
- 수량, 단가, 합계
- 거래 날짜

**통계:**
- 총 입고량
- 총 출고량
- 거래 건수

#### ➕ 입출고 탭

**입고 기록 추가:**
```
1. "원두 선택"
2. "입고량" 입력 (kg)
3. "단가" 입력 (원/kg)
4. "설명" 입력 (선택)
5. "✅ 입고 기록" 클릭
```

**출고 기록 추가:**
```
1. "원두 선택"
2. "출고량" 입력 (현재 재고 이하)
3. "단가" 입력
4. "설명" 입력
5. "✅ 출고 기록" 클릭
```

⚠️ **주의:** 현재 재고보다 많으면 오류 발생

#### ⚠️ 경고 탭

**저재고 경고:**
- 🔴 저재고 원두 강조 표시
- "부족량" 메트릭 표시

**과재고 경고:**
- 🟡 과재고 원두 표시
- "초과량" 메트릭 표시

**정상 재고:**
- 🟢 정상 범위의 원두 목록

**재고 범위 설정:**
```
1. "재고 범위를 조정할 원두 선택"
2. "최소 재고" 입력
3. "최대 재고" 입력
4. "💾 재고 범위 저장" 클릭
```

---

### 📄 6. 보고서

**위치:** 좌측 메뉴 → 6️⃣ 보고서

#### 📊 요약 보고서 탭

**월별 요약:**
```
1. 년도 선택
2. 월 선택
3. 자동으로 해당 월의:
   - 입고량, 출고량, 순변화
   - 거래액, 거래 건수
   - 거래 기록 표시
```

#### 💰 비용 분석 탭

**날짜 범위 선택:**
```
1. "시작 날짜" 선택
2. "종료 날짜" 선택
3. 자동으로 기간의:
   - 총 원가, 평균 원가
   - 블렌드별 상세 비용
   - 비용 구성 차트 표시
```

#### ☕ 원두 사용량 탭

**사용량 분석:**
- 원두별 입고/출고/순변화
- 사용 비용
- 시각화 차트

#### 🎨 블렌드 성과 탭

**성과 분석:**
- 가장 이익이 높은 블렌드 (🏆)
- 가장 이익이 낮은 블렌드 (⚠️)
- 블렌드별 수익률 비교
- 포션당 이익 비교

#### 📥 내보내기 탭

**Excel 내보내기:**
```
1. "내보낼 보고서 유형" 선택
   - 전체 보고서 (모든 데이터)
   - 요약 보고서
   - 비용 분석
   - 원두 사용량
   - 블렌드 성과

2. "📥 Excel 다운로드" 클릭
3. 파일 자동 다운로드
```

**CSV 내보내기:**
```
1. 보고서 유형 선택
2. "📥 CSV 다운로드" 클릭
```

---

### ⚙️ 7. 설정

**위치:** 좌측 메뉴 → 7️⃣ 설정

#### 💰 비용 설정 탭

**비용 파라미터 조정:**

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| 로스팅 손실율 | 16.7% | 로스팅 시 무게 감소량 |
| 로스팅 비용 | 2,000원/kg | 1kg당 로스팅 비용 |
| 인건비 | 15,000원/시간 | 시간당 인건비 |
| 로스팅 시간 | 2시간 | 한 배치 로스팅 시간 |
| 전기료 | 5,000원 | 로스팅당 전기료 |
| 기타 비용 | 3,000원 | 로스팅당 기타 비용 |
| 마진율 | 2.5배 | 판매가 마진 |

**수정 방법:**
```
1. 각 파라미터 옆의 입력창 또는 슬라이더 조정
2. "💾 저장" 클릭
3. 자동으로 모든 블렌드에 적용됨
```

#### ⚙️ 시스템 설정 탭

- 알림 설정 (저재고, 과재고)
- 화면 설정 (통화, 소수점)
- 시스템 정보 표시

#### 📊 데이터베이스 탭

**백업 생성:**
```
1. "💾 백업 생성" 클릭
2. 자동으로 파일 생성
3. 파일명: roasting_data_backup_YYYYMMDD_HHMMSS.db
```

**데이터 검증:**
```
1. "🔍 데이터 검증 실행" 클릭
2. 각 테이블의 유효성 확인
3. 결과 표시
```

**데이터 초기화 (위험):**
```
1. "⚠️ 데이터 초기화" 클릭
2. "✅ 정말로 초기화하시겠습니까?" 확인
3. 모든 데이터 삭제 (복구 불가능!)
```

---

### 📊 8. Excel 동기화

**위치:** 좌측 메뉴 → 8️⃣ Excel동기화

#### 📥 임포트 탭

**Excel에서 데이터 가져오기:**

```
1. "임포트할 데이터 유형" 선택
   - 원두 데이터
   - 블렌드 데이터

2. "Excel 파일 선택"
3. 파일 선택 후 자동 미리보기

4. "기존 데이터 병합" 체크
   (기존 데이터 업데이트 여부)

5. "✅ 임포트 실행" 클릭
6. 결과 확인 (성공/실패 개수)
```

#### 📤 내보내기 탭

**Excel로 데이터 내보내기:**

```
"📤 원두 내보내기" → Excel 다운로드
"📤 블렌드 내보내기" → Excel 다운로드
"📤 재고 내보내기" → Excel 다운로드
"📤 거래기록 내보내기" → Excel 다운로드 (최근 30일)
"📤 모든 데이터 내보내기" → 통합 Excel 다운로드
```

#### 📋 템플릿 탭

**임포트용 템플릿 다운로드:**

```
1. "📋 임포트 템플릿 다운로드" 클릭
2. Excel 파일 자동 다운로드
3. 파일에 데이터 입력
4. 임포트 탭에서 업로드
```

**템플릿 컬럼:**

원두 템플릿:
- No, 원두명, 국가, 로스팅, 가격/kg, 설명

블렌드 템플릿:
- 블렌드명, 타입, 포션, 설명

---

### 📈 9. 고급 분석

**위치:** 좌측 메뉴 → 9️⃣ 고급분석

#### 📊 트렌드 탭

**월별 거래 추이:**
```
1. "표시할 개월 수" 슬라이더 (3~24개월)
2. 월별 입출고 라인 차트
3. 월별 거래액 막대 차트
4. 통계 테이블
```

#### 🔮 예측 탭

**재고 예측:**
```
1. "예측 기간" 입력 (7~90일)
2. 원두별 향후 재고 예측
3. 소진 예상 일수
4. 위험 원두 경고
```

**사용량 예측:**
```
1. "예측 기간" 입력 (7~180일)
2. 일평균 사용량 메트릭
3. 누적 사용량 예측 차트
```

#### 💹 ROI 탭

**투자 수익률 분석:**
- 평균 ROI
- 최고/최저 ROI
- 블렌드별 상세 비교

#### ⚡ 성능 탭

**주요 지표:**
- 총 거래, 활성 원두/블렌드
- 월별 거래액, 거래당 평균액
- 활동성/다양성 점수

#### 🎯 효율성 탭

**원두 효율성:**
- 원두별 사용 빈도
- 사용량 분석
- 비용 분석

**블렌드 간 비교:**
- 수익률 비교
- 배수 비교
- 성과 순위

---

## 🔄 일반적인 작업 흐름

### 일일 운영 순서

```
1️⃣ 아침 시작
   → 대시보드 확인 (경고 확인)
   → 저재고 원두 재주문 검토

2️⃣ 로스팅 작업
   → 원두 관리에서 필요한 원두 선택
   → 재고 관리에서 사용량 기록

3️⃣ 판매
   → 대시보드에서 판매가 확인
   → 거래 기록 수동 입력 (향후 자동화)

4️⃣ 마감
   → 재고 현황 확인
   → 경고 확인
   → 필요시 설정 조정

5️⃣ 주간 마감
   → 분석 페이지로 주간 성과 확인
   → 보고서 생성 및 저장
```

### 월간 업무

```
월초: 비용 설정 검토
     (원두 가격, 로스팅 비용 등)

월중: 분석 페이지로 중간 현황 확인

월말:
  1. 보고서 생성
  2. 월별 성과 분석
  3. ROI 검토
  4. 다음 월 계획 수립
```

---

## ❓ FAQ

### Q: 원두 가격을 변경했는데 기존 블렌드는?
**A:** 실시간으로 적용됩니다. 원두 가격 변경 후 즉시 모든 블렌드의 원가가 재계산됩니다.

### Q: 블렌드 레시피를 변경하려면?
**A:** 현재는 블렌드를 삭제 후 새로 추가해야 합니다. (향후 개선 예정)

### Q: 과거 데이터를 백업하려면?
**A:** 설정 → 데이터베이스 → "💾 백업 생성" 클릭

### Q: 잘못 입력한 거래를 취소하려면?
**A:** 현재는 자동 삭제 기능이 없습니다. 관리자에게 문의하세요.

### Q: Excel에서 데이터를 대량으로 추가하려면?
**A:** Excel동기화 → 템플릿 다운로드 → 데이터 입력 → 임포트

### Q: 원화가 아닌 다른 통화를 사용하려면?
**A:** 설정 → 시스템 설정 → "통화 기호" 변경

---

## 📞 문제 해결

### 페이지가 로드되지 않음
```
→ 브라우저 새로고침 (F5)
→ Streamlit 앱 재시작
→ 브라우저 캐시 삭제
```

### 데이터가 저장되지 않음
```
→ 네트워크 연결 확인
→ 데이터베이스 연결 확인
→ 필수 필드 입력 확인
```

### 차트가 표시되지 않음
```
→ JavaScript 활성화 확인
→ 브라우저 업데이트
→ 다른 브라우저 시도
```

### Excel 임포트 오류
```
→ 파일 형식 확인 (.xlsx, .xls)
→ 필수 컬럼 확인
→ 템플릿 다시 다운로드
```

---

## 🔐 데이터 보안

### 백업
- 매월 정기 백업 권장
- 설정 → 데이터베이스 → 백업 생성

### 복구
- 백업 파일로 복구 가능
- 지원팀에 문의

### 접근 제어
- 현재 로그인 미구현 (향후 추가 예정)
- 로컬 네트워크 내에서만 사용 권장

---

## 📱 모바일 사용

**권장:** Chrome, Safari, Firefox의 최신 버전

**지원:** 반응형 디자인 (세로 모드에서도 사용 가능)

---

## 📧 문의 및 피드백

문제 발생 시:
1. 브라우저 개발자 도구 (F12) → Console 확인
2. 에러 메시지 스크린샷
3. 관리자에게 보고

---

**마지막 업데이트:** 2025-10-24
**버전:** 2.0.0
**상태:** 정식 버전
